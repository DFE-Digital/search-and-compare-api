language: csharp
dist: trusty
sudo: required
mono: none
dotnet: 2.1
env:
  global:
  - secure: SWBz9hCvvAuDdyPtBLLw54t6XYzgs9ecjilNhjWRt/Az2L4d3xpZXIrxHtXkAFi1O+WRoYVcDfd6YO0eQHqI2FYlXO/w44SDhc/lFdVhsJpstpYaXk/bwQ7FuwwbWseAuRIhClemM5v8/UMcGdcy8YKeobv7Gf/brXPkCFN+2bA8oKacmS5g7XnLGnEbVfjXBzaQeHdd17k05+PNLKLg6vVbVNT8RVaGkDiBKS3hiwuXZzZ/z0aeuhg7Vw+u+e34GCoUWwCfftdDrmXRlnPjWuPRW+DDVEU8WmJFlbwzOnzswIPUfOCb9G5IjIt2+5oF4NMm4h0u74Jl8TpB1KQWgsd6zSxeBZrTVF2BqgbSEs3TSFY6cAoA6VB2Z9fb6Mqh+ukBVOpME+N+EjC5bI639xpIF4vz1/XiiLfsxRrzeidXkCnS5pT/nlOt3AShGp1J8eaKW+Ikf/11MiDneaa04JK2Pdp+RO4upjtXxnZY6sMrSlo4U3OegR5FxzCp9SAXgWv4zRyQVneZ1I9o30wphObfV5nGaFzaDkfmH78TC/f9jbclRR1J8raH+tfHwvQVBPjxgre6lw8mb2SSLaNnumsSxQyH3uO8Kv/s9EjnhZE0hF0f9luMGMpfVxgrtz2a7BHfADlyLxRZjA6oFDpEdS8lF03ml4gSgHRCmusaePs=
  - POSTGRESQL_SERVICE_HOST=127.0.0.1
  - PG_USERNAME=postgres
  - PG_PASSWORD=
  - PG_DATABASE=travis_ci_test
  - secure: medztQFAUUW8pBWDVl4na4/wMKaN2cT0TzPDO+BHRAd8BVTB705qVd9R1SqjTuvIVOKZqSJ37w2BCMRFQrbXsbR2gRsUNC+4pcs3GIfHMPAGk4Ck301HEsg7LKNeY9Nae+4GDjbRq2+7SDbbdjfpdkQOf9L9e1WL0pqeC2a/VCvgPBCHLBrAJhBhO/xZlLfvR7gZ6CZmpC64OPW1YmnDYCReE5ZbIDJ5x64uDUfZIkM1QYsAXgRva0Nk/OLLJdnlKyMPxw3i61wQK/nCBpd1w6/zonM9x/Wr1FOg/CrHYFxh1gwiEharryjgHkPcu7I7HYqcEN9WaMBk8BQGPZxagOoBuJYnqNILas48K6pZM6XdNSy1z3OniYTtSupagpd7FiH408k86Gvd8C+sr8m228IxQa0qgQ3wCC7gjMTtWG+dznEDvufBdyUAW+t6XbqF17Lnu0e61uKrrbn60tOYK3gqlGBSGoNZu7Jz3GOk291BlkNB/5gJ1mcTdFqecJ9Alu+cgAVtvpSAN4Yr5KAxUuyvYZwYllcdqezdL54mMp7UBdPhQnprQObATOoMIS+RaUaI6gb/XnqhasQQ09t7QMoNkbFD5ioLzhQGweoB5sp8XumR+OOdeLVE30rEUwbpeLH+1320bBaLPEgibwtTgjmJY0035jTxQJtumP0rlco=
before_script:
- psql -c 'create database travis_ci_test;' -U postgres
script:
- "./travis-build.sh --quiet verify"
services:
- postgresql: '9.6'
deploy:
- provider: script
  script: git fetch --unshallow && git push https://govuk-dfe-bat-deployment-user:$AZURE_WA_PASSWORD@bat-dev-search-and-compare-api-app.scm.azurewebsites.net:443/bat-dev-search-and-compare-api-app.git
    HEAD:refs/heads/master
  on: master
- provider: script
  script: git fetch --unshallow && git push https://govuk-dfe-bat-deployment-user:$AZURE_WA_PASSWORD@bat-staging-search-and-compare-api-app.scm.azurewebsites.net:443/bat-staging-search-and-compare-api-app.git
    HEAD:refs/heads/master
  on: staging
- provider: script
  script: git fetch --unshallow && git push https://govuk-dfe-bat-deployment-user:$AZURE_WA_PASSWORD@bat-prod-search-and-compare-api-app.scm.azurewebsites.net:443/bat-prod-search-and-compare-api-app.git
    HEAD:refs/heads/master
  on: production
- provider: script
  script: "./travis-deploy-geocoder.sh govuk-dfe-bat-deployment-user:$AZURE_WA_PASSWORD
    bat-dev-search-and-compare-api-app"
  on: master
- provider: script
  script: "./travis-deploy-geocoder.sh govuk-dfe-bat-deployment-user:$AZURE_WA_PASSWORD
    bat-staging-search-and-compare-api-app"
  on: staging
- provider: script
  script: "./travis-deploy-geocoder.sh govuk-dfe-bat-deployment-user:$AZURE_WA_PASSWORD
    bat-prod-search-and-compare-api-app"
  on: production
- provider: script
  skip_cleanup: true
  script: chmod +x ./travis-nuget-deploy.sh && ./travis-nuget-deploy.sh $NUGET_API_KEY
  on:
    all_branches: true
notifications:
  slack:
    secure: LV9uQYUL169TE5cC5TpdbWqnSrz9SU4eMUTe1aRrLD3V0F3iSOFe+tW1wzjBiqGnZLzSnEpa2jZDnBdDUVf7XDFsE2goivoYp0RAfR+PHrzU9Ov2GTgyf7zztF7lJ3gUkiKQSr/PWg4tVIsc6tJb7sXEMkpdXklw4USmcR6pwMSEh8C/Lf1/prRD0kTnWjMoH9ZieSi3r32QY5SKaOS9CN8sVC1bCe1mQE/oAKHuc3BgE4TaD9rZ5VENkuP8mR4RhHtPhB9AfTWlSVDezfq+luHdIy6xjs/QxizzjyK0nwkbEw18BP3n0rgO/FRa2B/w8zkOHDuLXqPD5NmgZg8AMTRwJsyCUE7lrI9xlj5PpjpIAOk7oIDNgn1MgxjAwfX7Ht6IHOUn2vpA7QyPUNZueFm194myq2qmAYGdgwPnx0lslQ2YaymzP5nUh82F1TbfEaw3cXZ2wXa7VXK2NxXccvTrhA/niHVZ7YAh3QlvJsj/9DrBGxMrtRLvdx4fdqt7AAvR9fYcWjzwcjGM9bH3Vz5frxOX9E+mpt9Y2k4EodcZ3MrfYTDTfxBygi1pI+DNirMQ02orLLS6P6rFXfyMcraAo1c1NyzvpROXuFejSm1oJKVljsFuDzReFpjS7fch8rBwfqdTFrOM7HMhC+eT3Bzun5kTOI2i9jJ1j+ReBKo=
  on_success: always
  on_failure: always
